ARM GAS  C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s 			page 1


   1              		.cpu cortex-m4
   2              		.eabi_attribute 27, 1
   3              		.eabi_attribute 28, 1
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 1
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"parameter.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.rodata.Print_Parameters.str1.4,"aMS",%progbits,1
  18              		.align	2
  19              	.LC0:
  20 0000 4D6F746F 		.ascii	"Motor paris:%d \015\012\000"
  20      72207061 
  20      7269733A 
  20      2564200D 
  20      0A00
  21              		.global	__aeabi_f2d
  22 0012 0000     		.align	2
  23              	.LC1:
  24 0014 456E636F 		.ascii	"Encoder offset:%f \015\012\000"
  24      64657220 
  24      6F666673 
  24      65743A25 
  24      66200D0A 
  25 0029 000000   		.align	2
  26              	.LC2:
  27 002c 456E636F 		.ascii	"Encoder direction:%d \015\012 \000"
  27      64657220 
  27      64697265 
  27      6374696F 
  27      6E3A2564 
  28 0045 000000   		.align	2
  29              	.LC3:
  30 0048 49645F50 		.ascii	"Id_PID\000"
  30      494400
  31 004f 00       		.align	2
  32              	.LC4:
  33 0050 2573204B 		.ascii	"%s KP:%f,KI:%f,KD:%f\015\012\000"
  33      503A2566 
  33      2C4B493A 
  33      25662C4B 
  33      443A2566 
  34 0067 00       		.align	2
  35              	.LC5:
  36 0068 49715F50 		.ascii	"Iq_PID\000"
  36      494400
  37 006f 00       		.align	2
  38              	.LC6:
  39 0070 506F7369 		.ascii	"Position Offset:%f\015\012\000"
ARM GAS  C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s 			page 2


  39      74696F6E 
  39      204F6666 
  39      7365743A 
  39      25660D0A 
  40 0085 000000   		.align	2
  41              	.LC7:
  42 0088 7068693A 		.ascii	"phi:%f\015\012\000"
  42      25660D0A 
  42      00
  43              		.section	.text.Print_Parameters,"ax",%progbits
  44              		.align	1
  45              		.global	Print_Parameters
  46              		.arch armv7e-m
  47              		.syntax unified
  48              		.thumb
  49              		.thumb_func
  50              		.fpu fpv4-sp-d16
  52              	Print_Parameters:
  53              	.LVL0:
  54              	.LFB134:
  55              		.file 1 "Src/parameter.c"
   1:Src/parameter.c **** #include "parameter.h"
   2:Src/parameter.c **** #include "foc.h"
   3:Src/parameter.c **** #include "pid.h"
   4:Src/parameter.c **** 
   5:Src/parameter.c **** #include "uart_ext.h"
   6:Src/parameter.c **** 
   7:Src/parameter.c **** #define PARAMETER_FLASH_ADDRESS 0x08040000   // 扇区6 大小128kb
   8:Src/parameter.c **** #define PARAMETER_FLASH_ADDRESS_SECLECTOR FLASH_SECTOR_6
   9:Src/parameter.c **** 
  10:Src/parameter.c **** typedef struct 
  11:Src/parameter.c **** {
  12:Src/parameter.c ****     Motor_Parameter motor_info;
  13:Src/parameter.c ****     PID_S id_pid;
  14:Src/parameter.c ****     PID_S iq_pid;
  15:Src/parameter.c ****     float position_offset;
  16:Src/parameter.c ****     float phi;
  17:Src/parameter.c **** }Flash_Parameters;
  18:Src/parameter.c **** 
  19:Src/parameter.c **** #define STR(x)      #x
  20:Src/parameter.c **** 
  21:Src/parameter.c **** inline void Print_PID(char *name,PID_S * pid){
  22:Src/parameter.c ****     uprintf_polling("%s KP:%f,KI:%f,KD:%f\r\n",name,pid->KP,pid->KI,pid->KD);
  23:Src/parameter.c **** }
  24:Src/parameter.c **** 
  25:Src/parameter.c **** void Print_Parameters(Flash_Parameters *p){
  56              		.loc 1 25 43 view -0
  57              		.cfi_startproc
  58              		@ args = 0, pretend = 0, frame = 0
  59              		@ frame_needed = 0, uses_anonymous_args = 0
  60              		.loc 1 25 43 is_stmt 0 view .LVU1
  61 0000 2DE9F043 		push	{r4, r5, r6, r7, r8, r9, lr}
  62              	.LCFI0:
  63              		.cfi_def_cfa_offset 28
  64              		.cfi_offset 4, -28
  65              		.cfi_offset 5, -24
  66              		.cfi_offset 6, -20
ARM GAS  C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s 			page 3


  67              		.cfi_offset 7, -16
  68              		.cfi_offset 8, -12
  69              		.cfi_offset 9, -8
  70              		.cfi_offset 14, -4
  71 0004 85B0     		sub	sp, sp, #20
  72              	.LCFI1:
  73              		.cfi_def_cfa_offset 48
  74 0006 0446     		mov	r4, r0
  26:Src/parameter.c ****     uprintf_polling("Motor paris:%d \r\n",p->motor_info.Pairs);
  75              		.loc 1 26 5 is_stmt 1 view .LVU2
  76 0008 0178     		ldrb	r1, [r0]	@ zero_extendqisi2
  77 000a 2A48     		ldr	r0, .L3
  78              	.LVL1:
  79              		.loc 1 26 5 is_stmt 0 view .LVU3
  80 000c FFF7FEFF 		bl	uprintf_polling
  81              	.LVL2:
  27:Src/parameter.c ****     uprintf_polling("Encoder offset:%f \r\n",p->motor_info.Position_Phase_Offset);
  82              		.loc 1 27 5 is_stmt 1 view .LVU4
  83 0010 6068     		ldr	r0, [r4, #4]	@ float
  84 0012 FFF7FEFF 		bl	__aeabi_f2d
  85              	.LVL3:
  86 0016 0246     		mov	r2, r0
  87 0018 0B46     		mov	r3, r1
  88 001a 2748     		ldr	r0, .L3+4
  89 001c FFF7FEFF 		bl	uprintf_polling
  90              	.LVL4:
  28:Src/parameter.c ****     uprintf_polling("Encoder direction:%d \r\n ",p->motor_info.Encoder_Direction);
  91              		.loc 1 28 5 view .LVU5
  92 0020 217A     		ldrb	r1, [r4, #8]	@ zero_extendqisi2
  93 0022 2648     		ldr	r0, .L3+8
  94 0024 FFF7FEFF 		bl	uprintf_polling
  95              	.LVL5:
  29:Src/parameter.c ****     Print_PID(STR(Id_PID),&(p->id_pid));
  96              		.loc 1 29 5 view .LVU6
  97              	.LBB6:
  98              	.LBI6:
  21:Src/parameter.c ****     uprintf_polling("%s KP:%f,KI:%f,KD:%f\r\n",name,pid->KP,pid->KI,pid->KD);
  99              		.loc 1 21 13 view .LVU7
 100              	.LBB7:
  22:Src/parameter.c **** }
 101              		.loc 1 22 5 view .LVU8
  22:Src/parameter.c **** }
 102              		.loc 1 22 64 is_stmt 0 view .LVU9
 103 0028 D4F81C80 		ldr	r8, [r4, #28]	@ float
  22:Src/parameter.c **** }
 104              		.loc 1 22 72 view .LVU10
 105 002c D4F81890 		ldr	r9, [r4, #24]	@ float
  22:Src/parameter.c **** }
 106              		.loc 1 22 5 view .LVU11
 107 0030 6069     		ldr	r0, [r4, #20]	@ float
 108 0032 FFF7FEFF 		bl	__aeabi_f2d
 109              	.LVL6:
 110 0036 0646     		mov	r6, r0
 111 0038 0F46     		mov	r7, r1
 112 003a 214D     		ldr	r5, .L3+12
 113 003c 4846     		mov	r0, r9	@ float
 114 003e FFF7FEFF 		bl	__aeabi_f2d
ARM GAS  C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s 			page 4


 115              	.LVL7:
 116 0042 CDE90201 		strd	r0, [sp, #8]
 117 0046 4046     		mov	r0, r8	@ float
 118 0048 FFF7FEFF 		bl	__aeabi_f2d
 119              	.LVL8:
 120 004c CDE90001 		strd	r0, [sp]
 121 0050 3246     		mov	r2, r6
 122 0052 3B46     		mov	r3, r7
 123 0054 1B49     		ldr	r1, .L3+16
 124 0056 2846     		mov	r0, r5
 125 0058 FFF7FEFF 		bl	uprintf_polling
 126              	.LVL9:
  22:Src/parameter.c **** }
 127              		.loc 1 22 5 view .LVU12
 128              	.LBE7:
 129              	.LBE6:
  30:Src/parameter.c ****     Print_PID(STR(Iq_PID),&(p->iq_pid));
 130              		.loc 1 30 5 is_stmt 1 view .LVU13
 131              	.LBB8:
 132              	.LBI8:
  21:Src/parameter.c ****     uprintf_polling("%s KP:%f,KI:%f,KD:%f\r\n",name,pid->KP,pid->KI,pid->KD);
 133              		.loc 1 21 13 view .LVU14
 134              	.LBB9:
  22:Src/parameter.c **** }
 135              		.loc 1 22 5 view .LVU15
  22:Src/parameter.c **** }
 136              		.loc 1 22 64 is_stmt 0 view .LVU16
 137 005c D4F84080 		ldr	r8, [r4, #64]	@ float
  22:Src/parameter.c **** }
 138              		.loc 1 22 72 view .LVU17
 139 0060 D4F83C90 		ldr	r9, [r4, #60]	@ float
  22:Src/parameter.c **** }
 140              		.loc 1 22 5 view .LVU18
 141 0064 A06B     		ldr	r0, [r4, #56]	@ float
 142 0066 FFF7FEFF 		bl	__aeabi_f2d
 143              	.LVL10:
 144 006a 0646     		mov	r6, r0
 145 006c 0F46     		mov	r7, r1
 146              	.LVL11:
  22:Src/parameter.c **** }
 147              		.loc 1 22 5 view .LVU19
 148 006e 4846     		mov	r0, r9	@ float
 149 0070 FFF7FEFF 		bl	__aeabi_f2d
 150              	.LVL12:
 151 0074 CDE90201 		strd	r0, [sp, #8]
 152 0078 4046     		mov	r0, r8	@ float
 153 007a FFF7FEFF 		bl	__aeabi_f2d
 154              	.LVL13:
 155 007e CDE90001 		strd	r0, [sp]
 156 0082 3246     		mov	r2, r6
 157 0084 3B46     		mov	r3, r7
 158 0086 1049     		ldr	r1, .L3+20
 159 0088 2846     		mov	r0, r5
 160 008a FFF7FEFF 		bl	uprintf_polling
 161              	.LVL14:
  22:Src/parameter.c **** }
 162              		.loc 1 22 5 view .LVU20
ARM GAS  C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s 			page 5


 163              	.LBE9:
 164              	.LBE8:
  31:Src/parameter.c ****     uprintf_polling("Position Offset:%f\r\n",p->position_offset);
 165              		.loc 1 31 5 is_stmt 1 view .LVU21
 166 008e E06D     		ldr	r0, [r4, #92]	@ float
 167 0090 FFF7FEFF 		bl	__aeabi_f2d
 168              	.LVL15:
 169 0094 0246     		mov	r2, r0
 170 0096 0B46     		mov	r3, r1
 171 0098 0C48     		ldr	r0, .L3+24
 172 009a FFF7FEFF 		bl	uprintf_polling
 173              	.LVL16:
  32:Src/parameter.c ****     uprintf_polling("phi:%f\r\n",p->phi);
 174              		.loc 1 32 5 view .LVU22
 175 009e 206E     		ldr	r0, [r4, #96]	@ float
 176 00a0 FFF7FEFF 		bl	__aeabi_f2d
 177              	.LVL17:
 178 00a4 0246     		mov	r2, r0
 179 00a6 0B46     		mov	r3, r1
 180 00a8 0948     		ldr	r0, .L3+28
 181 00aa FFF7FEFF 		bl	uprintf_polling
 182              	.LVL18:
  33:Src/parameter.c **** }
 183              		.loc 1 33 1 is_stmt 0 view .LVU23
 184 00ae 05B0     		add	sp, sp, #20
 185              	.LCFI2:
 186              		.cfi_def_cfa_offset 28
 187              		@ sp needed
 188 00b0 BDE8F083 		pop	{r4, r5, r6, r7, r8, r9, pc}
 189              	.LVL19:
 190              	.L4:
 191              		.loc 1 33 1 view .LVU24
 192              		.align	2
 193              	.L3:
 194 00b4 00000000 		.word	.LC0
 195 00b8 14000000 		.word	.LC1
 196 00bc 2C000000 		.word	.LC2
 197 00c0 50000000 		.word	.LC4
 198 00c4 48000000 		.word	.LC3
 199 00c8 68000000 		.word	.LC5
 200 00cc 70000000 		.word	.LC6
 201 00d0 88000000 		.word	.LC7
 202              		.cfi_endproc
 203              	.LFE134:
 205              		.section	.text.Write_Parameter,"ax",%progbits
 206              		.align	1
 207              		.global	Write_Parameter
 208              		.syntax unified
 209              		.thumb
 210              		.thumb_func
 211              		.fpu fpv4-sp-d16
 213              	Write_Parameter:
 214              	.LFB136:
  34:Src/parameter.c **** 
  35:Src/parameter.c **** void Read_Parameters(uint8_t write_default){
  36:Src/parameter.c **** 
  37:Src/parameter.c **** 
ARM GAS  C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s 			page 6


  38:Src/parameter.c ****     Flash_Parameters temp = *(Flash_Parameters *)PARAMETER_FLASH_ADDRESS;
  39:Src/parameter.c ****     INIT:
  40:Src/parameter.c ****     if(temp.motor_info.Pairs==0xFF){
  41:Src/parameter.c ****         uprintf_polling("First time used, use default configuration!\r\n");
  42:Src/parameter.c ****         if(write_default){
  43:Src/parameter.c ****             Write_Parameter();
  44:Src/parameter.c ****             temp = *(Flash_Parameters *)PARAMETER_FLASH_ADDRESS; 
  45:Src/parameter.c ****             goto INIT;
  46:Src/parameter.c ****         }
  47:Src/parameter.c ****     }
  48:Src/parameter.c ****     Print_Parameters(&temp);
  49:Src/parameter.c **** 
  50:Src/parameter.c ****     Motor = temp.motor_info;
  51:Src/parameter.c ****     Id_PID = temp.id_pid;
  52:Src/parameter.c ****     Iq_PID = temp.iq_pid;
  53:Src/parameter.c ****     Phi = temp.phi;
  54:Src/parameter.c ****     Position_Offset = temp.position_offset;
  55:Src/parameter.c **** }
  56:Src/parameter.c **** 
  57:Src/parameter.c **** 
  58:Src/parameter.c **** void Write_Parameter(){
 215              		.loc 1 58 23 is_stmt 1 view -0
 216              		.cfi_startproc
 217              		@ args = 0, pretend = 0, frame = 128
 218              		@ frame_needed = 0, uses_anonymous_args = 0
 219 0000 70B5     		push	{r4, r5, r6, lr}
 220              	.LCFI3:
 221              		.cfi_def_cfa_offset 16
 222              		.cfi_offset 4, -16
 223              		.cfi_offset 5, -12
 224              		.cfi_offset 6, -8
 225              		.cfi_offset 14, -4
 226 0002 A0B0     		sub	sp, sp, #128
 227              	.LCFI4:
 228              		.cfi_def_cfa_offset 144
  59:Src/parameter.c ****     FLASH_EraseInitTypeDef EraseInitStruct;
 229              		.loc 1 59 5 view .LVU26
  60:Src/parameter.c ****     uint32_t SectorError = 0;
 230              		.loc 1 60 5 view .LVU27
 231              		.loc 1 60 14 is_stmt 0 view .LVU28
 232 0004 0026     		movs	r6, #0
 233 0006 1A96     		str	r6, [sp, #104]
  61:Src/parameter.c **** 
  62:Src/parameter.c ****    Flash_Parameters parameters;
 234              		.loc 1 62 4 is_stmt 1 view .LVU29
  63:Src/parameter.c ****    parameters.motor_info = Motor;
 235              		.loc 1 63 4 view .LVU30
 236              		.loc 1 63 26 is_stmt 0 view .LVU31
 237 0008 01AC     		add	r4, sp, #4
 238 000a 1F4D     		ldr	r5, .L11
 239 000c 0FCD     		ldmia	r5!, {r0, r1, r2, r3}
 240 000e 0FC4     		stmia	r4!, {r0, r1, r2, r3}
 241 0010 2B68     		ldr	r3, [r5]
 242 0012 2360     		str	r3, [r4]
  64:Src/parameter.c ****    parameters.id_pid = Id_PID;
 243              		.loc 1 64 4 is_stmt 1 view .LVU32
 244              		.loc 1 64 22 is_stmt 0 view .LVU33
ARM GAS  C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s 			page 7


 245 0014 06AC     		add	r4, sp, #24
 246 0016 1D4D     		ldr	r5, .L11+4
 247 0018 0FCD     		ldmia	r5!, {r0, r1, r2, r3}
 248 001a 0FC4     		stmia	r4!, {r0, r1, r2, r3}
 249 001c 0FCD     		ldmia	r5!, {r0, r1, r2, r3}
 250 001e 0FC4     		stmia	r4!, {r0, r1, r2, r3}
 251 0020 2B68     		ldr	r3, [r5]
 252 0022 2360     		str	r3, [r4]
  65:Src/parameter.c ****    parameters.iq_pid = Iq_PID;
 253              		.loc 1 65 4 is_stmt 1 view .LVU34
 254              		.loc 1 65 22 is_stmt 0 view .LVU35
 255 0024 0FAC     		add	r4, sp, #60
 256 0026 1A4D     		ldr	r5, .L11+8
 257 0028 0FCD     		ldmia	r5!, {r0, r1, r2, r3}
 258 002a 0FC4     		stmia	r4!, {r0, r1, r2, r3}
 259 002c 0FCD     		ldmia	r5!, {r0, r1, r2, r3}
 260 002e 0FC4     		stmia	r4!, {r0, r1, r2, r3}
 261 0030 2B68     		ldr	r3, [r5]
 262 0032 2360     		str	r3, [r4]
  66:Src/parameter.c ****    parameters.position_offset = Position_Offset;
 263              		.loc 1 66 4 is_stmt 1 view .LVU36
 264              		.loc 1 66 31 is_stmt 0 view .LVU37
 265 0034 174B     		ldr	r3, .L11+12
 266 0036 1B68     		ldr	r3, [r3]	@ float
 267 0038 1893     		str	r3, [sp, #96]	@ float
  67:Src/parameter.c ****    parameters.phi = Phi;
 268              		.loc 1 67 4 is_stmt 1 view .LVU38
 269              		.loc 1 67 19 is_stmt 0 view .LVU39
 270 003a 174B     		ldr	r3, .L11+16
 271 003c 1B68     		ldr	r3, [r3]	@ float
 272 003e 1993     		str	r3, [sp, #100]	@ float
  68:Src/parameter.c **** 
  69:Src/parameter.c ****    HAL_FLASH_Unlock();
 273              		.loc 1 69 4 is_stmt 1 view .LVU40
 274 0040 FFF7FEFF 		bl	HAL_FLASH_Unlock
 275              	.LVL20:
  70:Src/parameter.c ****   EraseInitStruct.TypeErase = FLASH_TYPEERASE_SECTORS;
 276              		.loc 1 70 3 view .LVU41
 277              		.loc 1 70 29 is_stmt 0 view .LVU42
 278 0044 1B96     		str	r6, [sp, #108]
  71:Src/parameter.c ****   EraseInitStruct.VoltageRange = FLASH_VOLTAGE_RANGE_3;
 279              		.loc 1 71 3 is_stmt 1 view .LVU43
 280              		.loc 1 71 32 is_stmt 0 view .LVU44
 281 0046 0223     		movs	r3, #2
 282 0048 1F93     		str	r3, [sp, #124]
  72:Src/parameter.c ****   EraseInitStruct.Sector = PARAMETER_FLASH_ADDRESS_SECLECTOR;
 283              		.loc 1 72 3 is_stmt 1 view .LVU45
 284              		.loc 1 72 26 is_stmt 0 view .LVU46
 285 004a 0623     		movs	r3, #6
 286 004c 1D93     		str	r3, [sp, #116]
  73:Src/parameter.c ****   EraseInitStruct.NbSectors = 1;
 287              		.loc 1 73 3 is_stmt 1 view .LVU47
 288              		.loc 1 73 29 is_stmt 0 view .LVU48
 289 004e 0123     		movs	r3, #1
 290 0050 1E93     		str	r3, [sp, #120]
  74:Src/parameter.c ****   if(HAL_FLASHEx_Erase(&EraseInitStruct, &SectorError) != HAL_OK)
 291              		.loc 1 74 3 is_stmt 1 view .LVU49
ARM GAS  C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s 			page 8


 292              		.loc 1 74 6 is_stmt 0 view .LVU50
 293 0052 1AA9     		add	r1, sp, #104
 294 0054 1BA8     		add	r0, sp, #108
 295 0056 FFF7FEFF 		bl	HAL_FLASHEx_Erase
 296              	.LVL21:
 297              		.loc 1 74 5 view .LVU51
 298 005a 10B9     		cbnz	r0, .L10
 299              	.L6:
  58:Src/parameter.c ****     FLASH_EraseInitTypeDef EraseInitStruct;
 300              		.loc 1 58 23 view .LVU52
 301 005c 01AD     		add	r5, sp, #4
 302 005e 0F4C     		ldr	r4, .L11+20
 303 0060 0AE0     		b	.L7
 304              	.L10:
  75:Src/parameter.c ****   { 
  76:Src/parameter.c ****     /* 
  77:Src/parameter.c ****       Error occurred while sector erase. 
  78:Src/parameter.c ****       User can add here some code to deal with this error. 
  79:Src/parameter.c ****       SectorError will contain the faulty sector and then to know the code error on this sector,
  80:Src/parameter.c ****       user can call function 'HAL_FLASH_GetError()'
  81:Src/parameter.c ****     */
  82:Src/parameter.c ****     /*
  83:Src/parameter.c ****       FLASH_ErrorTypeDef errorcode = HAL_FLASH_GetError();
  84:Src/parameter.c ****     */
  85:Src/parameter.c ****     Error_Handler();
 305              		.loc 1 85 5 is_stmt 1 view .LVU53
 306 0062 FFF7FEFF 		bl	Error_Handler
 307              	.LVL22:
 308 0066 F9E7     		b	.L6
 309              	.LVL23:
 310              	.L8:
  86:Src/parameter.c ****   } 
  87:Src/parameter.c ****   uint32_t addr = PARAMETER_FLASH_ADDRESS;
  88:Src/parameter.c ****   uint32_t *data_ptr =   (uint32_t *) &parameters;
  89:Src/parameter.c ****   while(addr<PARAMETER_FLASH_ADDRESS+sizeof(Flash_Parameters)){
  90:Src/parameter.c ****       HAL_FLASH_Program(FLASH_TYPEPROGRAM_WORD, addr, *data_ptr);
 311              		.loc 1 90 7 view .LVU54
 312 0068 55F8042B 		ldr	r2, [r5], #4
 313              	.LVL24:
 314              		.loc 1 90 7 is_stmt 0 view .LVU55
 315 006c 0023     		movs	r3, #0
 316 006e 2146     		mov	r1, r4
 317 0070 0220     		movs	r0, #2
 318 0072 FFF7FEFF 		bl	HAL_FLASH_Program
 319              	.LVL25:
  91:Src/parameter.c ****       addr+=4;
 320              		.loc 1 91 7 is_stmt 1 view .LVU56
 321              		.loc 1 91 11 is_stmt 0 view .LVU57
 322 0076 0434     		adds	r4, r4, #4
 323              	.LVL26:
  92:Src/parameter.c ****       data_ptr+=1;
 324              		.loc 1 92 7 is_stmt 1 view .LVU58
 325              	.L7:
  89:Src/parameter.c ****       HAL_FLASH_Program(FLASH_TYPEPROGRAM_WORD, addr, *data_ptr);
 326              		.loc 1 89 8 view .LVU59
 327 0078 094B     		ldr	r3, .L11+24
 328 007a 9C42     		cmp	r4, r3
ARM GAS  C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s 			page 9


 329 007c F4D9     		bls	.L8
  93:Src/parameter.c ****   }
  94:Src/parameter.c ****   HAL_FLASH_Lock();
 330              		.loc 1 94 3 view .LVU60
 331 007e FFF7FEFF 		bl	HAL_FLASH_Lock
 332              	.LVL27:
  95:Src/parameter.c **** }...
 333              		.loc 1 95 1 is_stmt 0 view .LVU61
 334 0082 20B0     		add	sp, sp, #128
 335              	.LCFI5:
 336              		.cfi_def_cfa_offset 16
 337              		@ sp needed
 338 0084 70BD     		pop	{r4, r5, r6, pc}
 339              	.LVL28:
 340              	.L12:
 341              		.loc 1 95 1 view .LVU62
 342 0086 00BF     		.align	2
 343              	.L11:
 344 0088 00000000 		.word	Motor
 345 008c 00000000 		.word	Id_PID
 346 0090 00000000 		.word	Iq_PID
 347 0094 00000000 		.word	Position_Offset
 348 0098 00000000 		.word	Phi
 349 009c 00000408 		.word	134479872
 350 00a0 63000408 		.word	134479971
 351              		.cfi_endproc
 352              	.LFE136:
 354              		.section	.rodata.Read_Parameters.str1.4,"aMS",%progbits,1
 355              		.align	2
 356              	.LC8:
 357 0000 46697273 		.ascii	"First time used, use default configuration!\015\012"
 357      74207469 
 357      6D652075 
 357      7365642C 
 357      20757365 
 358 002d 00       		.ascii	"\000"
 359              		.section	.text.Read_Parameters,"ax",%progbits
 360              		.align	1
 361              		.global	Read_Parameters
 362              		.syntax unified
 363              		.thumb
 364              		.thumb_func
 365              		.fpu fpv4-sp-d16
 367              	Read_Parameters:
 368              	.LVL29:
 369              	.LFB135:
  35:Src/parameter.c **** void Read_Parameters(uint8_t write_default){
 370              		.loc 1 35 44 is_stmt 1 view -0
 371              		.cfi_startproc
 372              		@ args = 0, pretend = 0, frame = 104
 373              		@ frame_needed = 0, uses_anonymous_args = 0
  35:Src/parameter.c **** void Read_Parameters(uint8_t write_default){
 374              		.loc 1 35 44 is_stmt 0 view .LVU64
 375 0000 30B5     		push	{r4, r5, lr}
 376              	.LCFI6:
 377              		.cfi_def_cfa_offset 12
 378              		.cfi_offset 4, -12
ARM GAS  C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s 			page 10


 379              		.cfi_offset 5, -8
 380              		.cfi_offset 14, -4
 381 0002 9BB0     		sub	sp, sp, #108
 382              	.LCFI7:
 383              		.cfi_def_cfa_offset 120
 384 0004 0446     		mov	r4, r0
  38:Src/parameter.c ****     Flash_Parameters temp = *(Flash_Parameters *)PARAMETER_FLASH_ADDRESS;
 385              		.loc 1 38 5 is_stmt 1 view .LVU65
  38:Src/parameter.c ****     Flash_Parameters temp = *(Flash_Parameters *)PARAMETER_FLASH_ADDRESS;
 386              		.loc 1 38 22 is_stmt 0 view .LVU66
 387 0006 6422     		movs	r2, #100
 388 0008 1A49     		ldr	r1, .L17
 389 000a 01A8     		add	r0, sp, #4
 390              	.LVL30:
  38:Src/parameter.c ****     Flash_Parameters temp = *(Flash_Parameters *)PARAMETER_FLASH_ADDRESS;
 391              		.loc 1 38 22 view .LVU67
 392 000c FFF7FEFF 		bl	memcpy
 393              	.LVL31:
 394              	.L14:
  40:Src/parameter.c ****     if(temp.motor_info.Pairs==0xFF){
 395              		.loc 1 40 5 is_stmt 1 view .LVU68
  40:Src/parameter.c ****     if(temp.motor_info.Pairs==0xFF){
 396              		.loc 1 40 23 is_stmt 0 view .LVU69
 397 0010 9DF80430 		ldrb	r3, [sp, #4]	@ zero_extendqisi2
  40:Src/parameter.c ****     if(temp.motor_info.Pairs==0xFF){
 398              		.loc 1 40 7 view .LVU70
 399 0014 FF2B     		cmp	r3, #255
 400 0016 0BD1     		bne	.L15
  41:Src/parameter.c ****         uprintf_polling("First time used, use default configuration!\r\n");
 401              		.loc 1 41 9 is_stmt 1 view .LVU71
 402 0018 1748     		ldr	r0, .L17+4
 403 001a FFF7FEFF 		bl	uprintf_polling
 404              	.LVL32:
  42:Src/parameter.c ****         if(write_default){
 405              		.loc 1 42 9 view .LVU72
  42:Src/parameter.c ****         if(write_default){
 406              		.loc 1 42 11 is_stmt 0 view .LVU73
 407 001e 3CB1     		cbz	r4, .L15
  43:Src/parameter.c ****             Write_Parameter();
 408              		.loc 1 43 13 is_stmt 1 view .LVU74
 409 0020 FFF7FEFF 		bl	Write_Parameter
 410              	.LVL33:
  44:Src/parameter.c ****             temp = *(Flash_Parameters *)PARAMETER_FLASH_ADDRESS; 
 411              		.loc 1 44 13 view .LVU75
  44:Src/parameter.c ****             temp = *(Flash_Parameters *)PARAMETER_FLASH_ADDRESS; 
 412              		.loc 1 44 18 is_stmt 0 view .LVU76
 413 0024 6422     		movs	r2, #100
 414 0026 1349     		ldr	r1, .L17
 415 0028 01A8     		add	r0, sp, #4
 416 002a FFF7FEFF 		bl	memcpy
 417              	.LVL34:
  45:Src/parameter.c ****             goto INIT;
 418              		.loc 1 45 13 is_stmt 1 view .LVU77
 419 002e EFE7     		b	.L14
 420              	.L15:
  48:Src/parameter.c ****     Print_Parameters(&temp);
 421              		.loc 1 48 5 view .LVU78
ARM GAS  C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s 			page 11


 422 0030 01A8     		add	r0, sp, #4
 423 0032 FFF7FEFF 		bl	Print_Parameters
 424              	.LVL35:
  50:Src/parameter.c ****     Motor = temp.motor_info;
 425              		.loc 1 50 5 view .LVU79
  50:Src/parameter.c ****     Motor = temp.motor_info;
 426              		.loc 1 50 11 is_stmt 0 view .LVU80
 427 0036 114D     		ldr	r5, .L17+8
 428 0038 01AC     		add	r4, sp, #4
 429 003a 0FCC     		ldmia	r4!, {r0, r1, r2, r3}
 430 003c 0FC5     		stmia	r5!, {r0, r1, r2, r3}
 431 003e 2368     		ldr	r3, [r4]
 432 0040 2B60     		str	r3, [r5]
  51:Src/parameter.c ****     Id_PID = temp.id_pid;
 433              		.loc 1 51 5 is_stmt 1 view .LVU81
  51:Src/parameter.c ****     Id_PID = temp.id_pid;
 434              		.loc 1 51 12 is_stmt 0 view .LVU82
 435 0042 0F4C     		ldr	r4, .L17+12
 436 0044 06AD     		add	r5, sp, #24
 437 0046 0FCD     		ldmia	r5!, {r0, r1, r2, r3}
 438 0048 0FC4     		stmia	r4!, {r0, r1, r2, r3}
 439 004a 0FCD     		ldmia	r5!, {r0, r1, r2, r3}
 440 004c 0FC4     		stmia	r4!, {r0, r1, r2, r3}
 441 004e 2B68     		ldr	r3, [r5]
 442 0050 2360     		str	r3, [r4]
  52:Src/parameter.c ****     Iq_PID = temp.iq_pid;
 443              		.loc 1 52 5 is_stmt 1 view .LVU83
  52:Src/parameter.c ****     Iq_PID = temp.iq_pid;
 444              		.loc 1 52 12 is_stmt 0 view .LVU84
 445 0052 0C4C     		ldr	r4, .L17+16
 446 0054 0FAD     		add	r5, sp, #60
 447 0056 0FCD     		ldmia	r5!, {r0, r1, r2, r3}
 448 0058 0FC4     		stmia	r4!, {r0, r1, r2, r3}
 449 005a 0FCD     		ldmia	r5!, {r0, r1, r2, r3}
 450 005c 0FC4     		stmia	r4!, {r0, r1, r2, r3}
 451 005e 2B68     		ldr	r3, [r5]
 452 0060 2360     		str	r3, [r4]
  53:Src/parameter.c ****     Phi = temp.phi;
 453              		.loc 1 53 5 is_stmt 1 view .LVU85
  53:Src/parameter.c ****     Phi = temp.phi;
 454              		.loc 1 53 9 is_stmt 0 view .LVU86
 455 0062 199A     		ldr	r2, [sp, #100]	@ float
 456 0064 084B     		ldr	r3, .L17+20
 457 0066 1A60     		str	r2, [r3]	@ float
  54:Src/parameter.c ****     Position_Offset = temp.position_offset;
 458              		.loc 1 54 5 is_stmt 1 view .LVU87
  54:Src/parameter.c ****     Position_Offset = temp.position_offset;
 459              		.loc 1 54 21 is_stmt 0 view .LVU88
 460 0068 189A     		ldr	r2, [sp, #96]	@ float
 461 006a 084B     		ldr	r3, .L17+24
 462 006c 1A60     		str	r2, [r3]	@ float
  55:Src/parameter.c **** }
 463              		.loc 1 55 1 view .LVU89
 464 006e 1BB0     		add	sp, sp, #108
 465              	.LCFI8:
 466              		.cfi_def_cfa_offset 12
 467              		@ sp needed
ARM GAS  C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s 			page 12


 468 0070 30BD     		pop	{r4, r5, pc}
 469              	.L18:
 470 0072 00BF     		.align	2
 471              	.L17:
 472 0074 00000408 		.word	134479872
 473 0078 00000000 		.word	.LC8
 474 007c 00000000 		.word	Motor
 475 0080 00000000 		.word	Id_PID
 476 0084 00000000 		.word	Iq_PID
 477 0088 00000000 		.word	Phi
 478 008c 00000000 		.word	Position_Offset
 479              		.cfi_endproc
 480              	.LFE135:
 482              		.text
 483              	.Letext0:
 484              		.file 2 "c:\\arm_gcc\\arm-none-eabi\\include\\machine\\_default_types.h"
 485              		.file 3 "c:\\arm_gcc\\arm-none-eabi\\include\\sys\\_stdint.h"
 486              		.file 4 "Drivers/CMSIS/Include/core_cm4.h"
 487              		.file 5 "Drivers/CMSIS/Device/ST/STM32F4xx/Include/system_stm32f4xx.h"
 488              		.file 6 "Drivers/CMSIS/Device/ST/STM32F4xx/Include/stm32f405xx.h"
 489              		.file 7 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_def.h"
 490              		.file 8 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_dma.h"
 491              		.file 9 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_flash_ex.h"
 492              		.file 10 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_tim.h"
 493              		.file 11 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal.h"
 494              		.file 12 "Inc/tim.h"
 495              		.file 13 "Src/SVPWM.h"
 496              		.file 14 "mylib/pid.h"
 497              		.file 15 "Src/foc.h"
 498              		.file 16 "c:\\arm_gcc\\arm-none-eabi\\include\\sys\\lock.h"
 499              		.file 17 "c:\\arm_gcc\\arm-none-eabi\\include\\sys\\_types.h"
 500              		.file 18 "c:\\arm_gcc\\lib\\gcc\\arm-none-eabi\\9.2.1\\include\\stddef.h"
 501              		.file 19 "c:\\arm_gcc\\arm-none-eabi\\include\\sys\\reent.h"
 502              		.file 20 "c:\\arm_gcc\\arm-none-eabi\\include\\stdlib.h"
 503              		.file 21 "mylib/uart_ext.h"
 504              		.file 22 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_flash.h"
 505              		.file 23 "Inc/main.h"
 506              		.file 24 "<built-in>"
ARM GAS  C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s 			page 13


DEFINED SYMBOLS
                            *ABS*:00000000 parameter.c
C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s:18     .rodata.Print_Parameters.str1.4:00000000 $d
C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s:44     .text.Print_Parameters:00000000 $t
C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s:52     .text.Print_Parameters:00000000 Print_Parameters
C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s:194    .text.Print_Parameters:000000b4 $d
C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s:206    .text.Write_Parameter:00000000 $t
C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s:213    .text.Write_Parameter:00000000 Write_Parameter
C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s:344    .text.Write_Parameter:00000088 $d
C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s:355    .rodata.Read_Parameters.str1.4:00000000 $d
C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s:360    .text.Read_Parameters:00000000 $t
C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s:367    .text.Read_Parameters:00000000 Read_Parameters
C:\Users\ncer\AppData\Local\Temp\ccWLPx4F.s:472    .text.Read_Parameters:00000074 $d

UNDEFINED SYMBOLS
__aeabi_f2d
uprintf_polling
HAL_FLASH_Unlock
HAL_FLASHEx_Erase
Error_Handler
HAL_FLASH_Program
HAL_FLASH_Lock
Motor
Id_PID
Iq_PID
Position_Offset
Phi
memcpy
